import{f as X,u as V,i as K,a as Y,b as U,D as J}from"./lit-CA_PTuLV.js";import{o as A,O as B,b as T,B as D,p as Q,q as Z,E as R,P as E,r as ee,s as te,t as ie,a as z,u as se,v as ne,m as ae,w as re,d as oe}from"./three-BwIRAmMQ.js";import{C as k,a as he,E as le,O as ce,S as de,F as pe,R as ue,b as be}from"./three-addons-BOjiernq.js";import{E as H,T as g}from"./tweenjs-Ba4GXh2m.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const ge={attribute:!0,type:String,converter:V,reflect:!1,hasChanged:X},me=(h=ge,e,t)=>{const{kind:s,metadata:i}=t;let n=globalThis.litPropertyMetadata.get(i);if(n===void 0&&globalThis.litPropertyMetadata.set(i,n=new Map),s==="setter"&&((h=Object.create(h)).wrapped=!0),n.set(t.name,h),s==="accessor"){const{name:a}=t;return{set(r){const l=e.get.call(this);e.set.call(this,r),this.requestUpdate(a,l,h,!0,r)},init(r){return r!==void 0&&this.C(a,void 0,h,r),r}}}if(s==="setter"){const{name:a}=t;return function(r){const l=this[a];e.call(this,r),this.requestUpdate(a,l,h,!0,r)}}throw Error("Unsupported decorator location: "+s)};function d(h){return(e,t)=>typeof t=="object"?me(h,e,t):((s,i,n)=>{const a=i.hasOwnProperty(n);return i.constructor.createProperty(n,s),a?Object.getOwnPropertyDescriptor(i,n):void 0})(h,e,t)}function q(h){return d({...h,state:!0,attribute:!1})}const fe=new A({color:0,visible:!1}),ye={bevelEnabled:!0,steps:8,bevelSize:.05,bevelThickness:.1,bevelSegments:4,bevelOffset:-.05,curveSegments:32},we={bevelEnabled:!1,curveSegments:32};class xe extends B{constructor(e,t="lambert"){super(),this._sizeInRadians=0,this._innerWidth=5,this._outerWidth=8,this._thickness=.5,this._labelMargin=.5,this._needsUpdate=!1,this._timeout=null,this.invisibleMesh=new T(new D,fe),this.labelDiv=document.createElement("div"),this.labelSpan=document.createElement("span"),this.label=new k(this.labelDiv),this.percentDiv=document.createElement("div"),this.percentSpan=document.createElement("span"),this.percentIndicator=new k(this.percentDiv),this._percentMargin=0,this.material=t==="basic"?new A({color:e}):new Q({color:e,polygonOffset:!0,polygonOffsetFactor:2}),this.mesh=new T(new D,this.material),this.add(this.mesh),this.add(this.invisibleMesh),this.rotateX(Math.PI*1.5),this.setupLabel(e),this.setupPercentIndicator()}set innerWidth(e){this._innerWidth!==e&&(this.needsUpdate=!0),this._innerWidth=e}get innerWidth(){return this._innerWidth}set outerWidth(e){this._outerWidth!==e&&(this.needsUpdate=!0),this._outerWidth=e}get outerWidth(){return this._outerWidth}set sizeInRadians(e){this._sizeInRadians!==e&&(this.needsUpdate=!0),this._sizeInRadians=e}get sizeInRadians(){return this._sizeInRadians}set thickness(e){this._thickness!==e&&(this.needsUpdate=!0),this._thickness=e}get thickness(){return this._thickness}set labelMargin(e){this._labelMargin!==e&&(this.needsUpdate=!0),this._labelMargin=e}get labelMargin(){return this._labelMargin}set percentMargin(e){this.percentMargin!==e&&(this.needsUpdate=!0),this._percentMargin=e}get percentMargin(){return this._percentMargin}set needsUpdate(e){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(()=>this.update()),this._needsUpdate=e}get needsUpdate(){return this._needsUpdate}update(){this.updateGeometry(),this.updateLabels()}setLabelText(e){this.labelSpan.innerHTML=e}setPercentText(e){this.percentSpan.innerHTML=e}hideLabel(){this.labelSpan.style.display="none"}showLabel(){this.labelSpan.style.display="block"}hidePercent(){this.percentSpan.style.display="none"}showPercent(){this.percentSpan.style.display="block"}setupLabel(e){const{labelDiv:t,labelSpan:s,label:i,mesh:n}=this;s.style.borderBottom=`2px solid #${e.toString(16).padStart(6,"0")}`,t.className="label",t.appendChild(s),t.style.backgroundColor="transparent",i.center.set(.5,1),i.layers.set(0),n.add(i)}setupPercentIndicator(){const{percentDiv:e,percentSpan:t,percentIndicator:s,mesh:i}=this;e.className="pct",e.style.backgroundColor="transparent",e.appendChild(t),s.center.set(0,1),s.layers.set(0),i.add(s)}getArcShape(){const{innerWidth:e,outerWidth:t,sizeInRadians:s}=this,i=new Z;return i.moveTo(e,0),i.lineTo(t,0),i.absarc(0,0,t,0,s,!1),i.absarc(0,0,e,s,0,!0),i.closePath(),i}updateGeometry(){const{mesh:e,invisibleMesh:t}=this,s=this.getArcShape(),i=new R(s,{...ye,depth:this.thickness}),n=new R(s,{...we,depth:this.thickness});e.geometry.dispose(),e.geometry=i,t.geometry.dispose(),t.geometry=n}updateLabels(){const e=this.getLabelPoint(),t=this.getPercentPoint();this.label.position.set(e.x,e.y,this.thickness+.2),this.percentIndicator.position.set(t.x,t.y,this.thickness+.2)}hideLabels(){this.setLabelText(""),this.setPercentText(""),this.labelMargin=0}getMovePoint(e){const t=new E;return t.absarc(0,0,e,0,this.sizeInRadians/2,!1),t.getPoints(2).pop()}getLabelPoint(){const e=new E,t=this.outerWidth+this.labelMargin;return e.absarc(0,0,t,0,this.sizeInRadians/2,!1),e.getPoints(2).pop()}getPercentPoint(){const e=new E,t=this.innerWidth===0?this.outerWidth*.65:this.innerWidth+(this.outerWidth-this.innerWidth)/2;return console.log("percentMargin",this.percentMargin),e.absarc(0,0,t+this.percentMargin,0,this.sizeInRadians/2,!1),e.getPoints(2).pop()}}var Se=Object.defineProperty,c=(h,e,t,s)=>{for(var i=void 0,n=h.length-1,a;n>=0;n--)(a=h[n])&&(i=a(e,t,i)||i);return i&&Se(e,t,i),i};const ve={red:16007990,blue:2201331,orange:16750592,green:5025616,yellow:16771899,pink:15277667,lightblue:240116,purple:10233776,amber:16761095,lightgreen:9159498,indigo:7964363,cyan:48340,teal:38536,brown:9268835,bluegrey:6323595,deeppurple:6765239},W=Math.PI*2,_=-W,y=H.Exponential.InOut,N=H.Exponential.InOut;function Pe(h,e){return!(e.left>h.right||e.right<h.left||e.top>h.bottom||e.bottom<h.top)}const L=class L extends K{constructor(){super(...arguments),this.slices={},this.colors=Object.values(ve),this.innerWidth=4,this.outerWidth=8,this.labelMargin=1.5,this.thickness=.5,this.highlightDistance=1,this.outlineColor=16777215,this.width=0,this.height=0,this.lightIntensity=1,this.ambientLightIntensity=.4,this.toneMappingExposure=1.5,this.animationDuration=1500,this.hideLabels=!1,this.hidePercents=!1,this.material="lambert",this.renderer=new ee({alpha:!0,antialias:!1}),this.scene=new te,this.camera=new ie(30,this.width/this.height,1,100),this.sliceContainer=new B,this.pointer=new z(1e3,1e3),this.raycaster=new se,this.intersected=null,this.invisibleSlices=[],this.labelRenderer=new he,this.composer=new le(this.renderer),this.outlinePass=new ce(new z(this.width,this.height),this.scene,this.camera),this.shaderPass=new de(pe),this.light=new ne(16777215,this.lightIntensity),this.resizeObserver=new ResizeObserver(this.onResize.bind(this)),this.initialAnimation=!0,this.actualWidth=0,this.actualHeight=0,this.resizeTween=new g(this).easing(y),this.lightTween=new g(this.light).easing(y),this.cnt=0}firstUpdated(){const{renderer:e,labelRenderer:t,composer:s,camera:i,outlinePass:n,scene:a,sliceContainer:r,outlineColor:l,light:u}=this,{devicePixelRatio:m}=window,f=this.shadowRoot.querySelector("#main");f.appendChild(e.domElement),f.appendChild(t.domElement),f.addEventListener("mousemove",this.onPointerMove.bind(this)),f.addEventListener("click",this.onPointerClick.bind(this)),u.position.set(-10,10,10),e.toneMapping=ae,e.toneMappingExposure=this.toneMappingExposure,e.setPixelRatio(m),e.setAnimationLoop(this._animate.bind(this)),t.domElement.style.position="absolute",t.domElement.style.top="0px",i.position.set(0,20,27),i.lookAt(0,0,0),n.edgeStrength=4,n.edgeGlow=0,n.edgeThickness=2.5,n.visibleEdgeColor.set(l),n.hiddenEdgeColor.set(l),s.setPixelRatio(m),s.addPass(new ue(a,i)),s.addPass(n),s.addPass(new be),s.addPass(this.shaderPass),r.rotateY(Math.PI*.5),a.add(r),a.add(new re(16777215,this.ambientLightIntensity)),a.add(u),this.resizeObserver.observe(this),console.log("first updated")}onResize(){let{width:e,height:t}=this;if(console.log("onresize"),!e||!t){const s=this.getBoundingClientRect();e||(e=s.width),t||(t=s.height)}e=Math.max(240,e),t=Math.max(180,t),this.actualWidth=e,this.actualHeight=t}updateSize(){const{renderer:e,labelRenderer:t,composer:s,camera:i,shaderPass:n,outlinePass:a,actualWidth:r,actualHeight:l}=this,{devicePixelRatio:u}=window;i.aspect=r/l,i.updateProjectionMatrix(),e.setSize(r,l),t.setSize(r,l),s.setSize(r,l),a.setSize(r,l),n.uniforms.resolution.value.set(1/r*u,1/l*u),this.renderScene()}setupSlices(){const{sliceContainer:e,slices:t,labelMargin:s,colors:i,invisibleSlices:n,animationDuration:a}=this,{innerWidth:r,outerWidth:l,thickness:u}=this,m=e.children,f=Object.keys(t).length,{selectedObjects:C}=this.outlinePass;if(f<m.length)for(let x=f;x<m.length;x++){const b=e.children[x];b.hideLabels(),b.userData.animtween=new g(b).to({sizeInRadians:0,innerWidth:r,outerWidth:l,thickness:u},a).easing(y).start(),b.userData.rotatetween=new g(b.rotation).to({z:_},a).easing(y).start();const P=C.indexOf(b);P!==-1&&(this.resetSlice(b),C.splice(P,1))}let I=0;Object.keys(t).forEach((x,b)=>{if(!e.children[b]){const w=new xe(i[b],this.material);if(e.add(w),n.push(w.invisibleMesh),this.initialAnimation){const{innerWidth:S,outerWidth:O,thickness:M}=this;Object.assign(w,{sizeInRadians:0,innerWidth:S,outerWidth:O,thickness:M})}else{const{innerWidth:S,outerWidth:O,thickness:M}=this.sliceContainer.children[0];Object.assign(w,{sizeInRadians:0,innerWidth:S,outerWidth:O,thickness:M}),w.rotation.z=_}}const G=Object.values(t).reduce((w,S)=>w+S,0),v=t[x]/G*W,$=v/W*100,p=e.children[b],F=-(v+I);p.userData.animtween=new g(p).to({sizeInRadians:v,innerWidth:r,outerWidth:l,thickness:u},a).easing(y).start(),p.userData.rotatetween=new g(p.rotation).to({z:F},a).easing(y).start(),p.labelMargin=0,p.percentMargin=0,p.setLabelText(x),p.setPercentText(`${$.toFixed(1)}%`),p.hideLabel(),p.hidePercent(),this.labelRenderer.render(this.scene,this.camera),setTimeout(()=>{this.hideLabels||p.showLabel(),this.hidePercents||p.showPercent(),p.userData.labeltween=new g(p).to({labelMargin:s},this.animationDuration/5).easing(N).start(),this.initialAnimation=!1},a),I+=v}),setTimeout(()=>{this.cnt=0,this.fixOverlaps("labelSpan"),this.fixOverlaps("percentSpan")},this.animationDuration+this.animationDuration/5)}fixOverlaps(e="labelSpan"){const t=this.sliceContainer.children;let s=!1;t.forEach((i,n)=>{if(n===0)return;const a=i[e].getBoundingClientRect(),r=t[n-1][e].getBoundingClientRect();Pe(a,r)&&(s=!0,e==="labelSpan"?i.labelMargin+=.07:i.percentMargin+=.03)}),s&&this.cnt<300&&(this.cnt++,this.labelRenderer.render(this.scene,this.camera),setTimeout(()=>this.fixOverlaps(e),5))}updated(e){if((e.has("slices")||e.has("outerWidth")||e.has("innerWidth")||e.has("thickness"))&&this.setupSlices(),e.has("colors")&&this.updateColors(),e.has("lightIntensity")&&this.lightTween.to({intensity:this.lightIntensity},this.animationDuration).start(),e.has("labelMargin")&&this.sliceContainer.children.forEach(s=>{s.userData.labeltween=new g(s).to({labelMargin:this.labelMargin}).easing(y).start()}),e.has("hideLabels")&&!this.initialAnimation){const t=this.sliceContainer.children;this.hideLabels?t.forEach(s=>s.hideLabel()):t.forEach(s=>s.showLabel())}if(e.has("hidePercents")&&!this.initialAnimation){const t=this.sliceContainer.children;this.hidePercents?t.forEach(s=>s.hidePercent()):(console.log("showing percents",t.length),t.forEach(s=>s.showPercent()))}if(e.has("width")||e.has("height")){if(!this.width||!this.height)return;this.resizeTween.to({actualWidth:this.width,actualHeight:this.height},this.animationDuration).start()}(e.has("actualWidth")||e.has("actualHeight"))&&this.updateSize()}updateColors(){const{animationDuration:e}=this;this.colors.forEach((t,s)=>{if(s>=this.sliceContainer.children.length)return;const i=this.sliceContainer.children[s],n=new oe(t),{r:a,g:r,b:l}=n;i.userData.colortween=new g(i.material.color).to({r:a,g:r,b:l},e).onUpdate(()=>{const{r:u,g:m,b:f}=i.material.color;i.labelSpan.style.borderBottomColor=`rgba(${u*255},${m*255},${f*255})`}).easing(y).start()})}onPointerMove(e){e.offsetX===0&&e.offsetY===0||(this.pointer.x=e.offsetX/this.actualWidth*2-1,this.pointer.y=-(e.offsetY/this.actualHeight)*2+1)}onPointerClick(){const{intersected:e,sliceContainer:t}=this,{selectedObjects:s}=this.outlinePass;if(e){const i=s.indexOf(e);if(i!==-1)s.splice(i,1);else{const a=t.children.indexOf(e);this.dispatchEvent(new CustomEvent("slice-selected",{detail:{index:a}})),s.push(e)}const n=s.map(a=>t.children.indexOf(a));this.dispatchEvent(new CustomEvent("selection-changed",{detail:{selectedSlices:n}}))}}moveSliceOut(e){const{x:t,y:s}=e.getMovePoint(this.highlightDistance),i=this.thickness+.2;e.userData.tween=new g(e.children[0].position).to({x:t,y:s,z:i},700).easing(N).start()}resetSlice(e){e.userData.tween=new g(e.children[0].position).to({x:0,y:0,z:0},100).start()}renderScene(){const{raycaster:e,intersected:t,pointer:s,camera:i,invisibleSlices:n,scene:a}=this,{selectedObjects:r}=this.outlinePass;e.setFromCamera(s,i);const l=e.intersectObjects(n,!1);if(l.length>0){const u=n.indexOf(l[0].object),m=this.sliceContainer.children[u];t!==m&&(t&&!r.includes(t)&&this.resetSlice(t),this.intersected=m,this.moveSliceOut(this.intersected))}else t&&!r.includes(t)&&this.resetSlice(t),this.intersected=null;this.composer.render(),this.labelRenderer.render(a,i)}_animate(e){this.sliceContainer.children.forEach(t=>{t.userData.tween?.update(e),t.userData.animtween?.update(e),t.userData.rotatetween?.update(e),t.userData.labeltween?.update(e),t.userData.colortween?.update(e)}),this.resizeTween.update(e),this.lightTween.update(e),this.renderScene()}render(){return U`<div id="main" style="width: ${this.actualWidth}px; height: ${this.actualHeight}px;"></div>`}};L.styles=Y`
		:host {
			display: inline-block;
			position: relative;
			color: currentColor;
			width: 100%;
			height: 100%;
		}
		#main {
			width: 100%;
			height: 100%;
		}
		.label,
		.pct {
			pointer-events: none;
		}
		.pct span {
			position: absolute;
			left: 0;
			transform: translate(-50%, -50%);
			text-align: center;
			font-size: var(--pie-3d-pct-font-size, 0.8em);
			color: #eee;
			text-shadow: 1px 1px 0px #111;
			line-height: 1.1;
		}
		.label span {
			position: absolute;
			left: 0;
			transform: translate(-50%, -50%);
			text-align: center;
			border-bottom: 2px solid transparent;
			display: none;
			line-height: 1.1;
		}
	`;let o=L;c([d({type:Object})],o.prototype,"slices");c([d({type:Array})],o.prototype,"colors");c([d({type:Number})],o.prototype,"innerWidth");c([d({type:Number})],o.prototype,"outerWidth");c([d({type:Number})],o.prototype,"labelMargin");c([d({type:Number})],o.prototype,"thickness");c([d({type:Number})],o.prototype,"highlightDistance");c([d({type:Number})],o.prototype,"outlineColor");c([d({type:Number})],o.prototype,"width");c([d({type:Number})],o.prototype,"height");c([d({type:Number})],o.prototype,"lightIntensity");c([d({type:Number})],o.prototype,"ambientLightIntensity");c([d({type:Number})],o.prototype,"toneMappingExposure");c([d({type:Number})],o.prototype,"animationDuration");c([d({type:Boolean})],o.prototype,"hideLabels");c([d({type:Boolean})],o.prototype,"hidePercents");c([d({type:String})],o.prototype,"material");c([q()],o.prototype,"actualWidth");c([q()],o.prototype,"actualHeight");window.customElements.define("pie-3d",o);const Oe={red:16007990,blue:2201331,orange:16750592,green:5025616,yellow:16771899,pink:15277667,lightblue:240116,purple:10233776,amber:16761095,lightgreen:9159498,indigo:7964363,cyan:48340,teal:38536,brown:9268835,bluegrey:6323595,deeppurple:9795021},Me={blue:2201331,yellow:16771899,orange:16750592,pink:15277667,green:5025616,red:16007990,lightblue:240116,amber:16761095,purple:10233776,lighgreen:9159498,brown:7951688,teal:38536,indigo:4149685,cyan:48340,bluegrey:6323595,deeppurple:6765239},Ee={Belgium:25,UK:5,Germany:3,France:35,Luxemburg:10,"The Netherlands":30,Hungary:7,Denmark:1,Italy:12,Spain:15,Portugal:8},j={Belgium:56,UK:5,Germany:13,France:22,Luxemburg:14,"The Netherlands":32,Hungary:9,Denmark:1,Italy:14,Spain:15,Portugal:41,Switzerland:11,Austria:32,Sweden:11,Norway:14,Finland:3};let We=Ee;setTimeout(()=>{console.log("set slices",j),document.querySelector("pie-3d").slices=j,document.querySelector("pie-3d").innerWidth=3,document.querySelector("pie-3d").colors=Object.values(Oe)},9e3);setTimeout(()=>{document.querySelector("pie-3d").width=640,document.querySelector("pie-3d").height=480},6e3);setTimeout(()=>{document.querySelector("pie-3d").innerWidth=0},6e3);setTimeout(()=>{document.querySelector("pie-3d").colors=Object.values(Me)},3e3);J(U` <div style="width:1024px;height:768px">
					<pie-3d .slices="${We}" animationDuration="1500">
						<h1>Vite + Lit</h1>
					</pie-3d>
				</div>`,document.getElementById("demo"));
